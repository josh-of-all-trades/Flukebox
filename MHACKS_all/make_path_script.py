import os
import sys
baseurl="http://169.254.8.45/MHACKS/"
fn = sys.argv[1]
audioname = sys.argv[2]

dirno=int(fn.replace('upload','').replace('/',''))

g2='<?php\nheader("Location: play.html");\n$audio_fn = "'+audioname+'";\n$control_file = \'control.txt\';\n$ts = time()+30;\n$py_str= ("python create_timed_play_page.py "."\'".$audio_fn."\' ".$ts);\nexec($py_str);\nfwrite(fopen($control_file, \'w\'),$ts);\nexit;\n?>'
f2 = open(fn+'activate.php' ,'w')
f2.write(g2)
f2.close()

preplayurl = baseurl+fn+'preplay.php'
g3='<!DOCTYPE HTML>\n<html style="background-image=url(\'ugh.png\')">\n<body style="background-image:url(\'body_bckg.jpg\');background-repeat:repeat">\n\n<h1 style="color:#0000ff;margin-left:400px;font-family:sans-serif;font-size:40px"> Flukebox </h1>\n\n<p style="color:#ff0000;margin-left:30px;font-family:sans-serif;font-size:12;display:block">\n\tSend this link to everyone who is going to use their device as a speaker!  You are almost finished!! Hurray it\'s almost party time!!!\n</p>\n\n<a href="'+preplayurl+'" style="margin-left:30px;margin-right:auto;font-family:sans-serif;font-size:14px;display:block"> <p style=""> http://localhost/MHACKS/'+fn+'preplay.php</p></a>\n<img src=qr_'+str(dirno)+'.png />\n<form action="activate.php">\n<input style="margin-left:30px;font-sans-serif;font-size:14" type="submit" name="Play" value="Play">\n</form>\n\n\n</body>\n</html>'
#arbitrary qr g3='<!DOCTYPE HTML>\n<html style="background-image=url(\'ugh.png\')">\n<body style="background-image:url(\'body_bckg.jpg\');background-repeat:repeat">\n\n<h1 style="color:#0000ff;margin-left:400px;font-family:sans-serif;font-size:40px"> Flukebox </h1>\n\n<p style="color:#ff0000;margin-left:30px;font-family:sans-serif;font-size:12;display:block">\n\tSend this link to everyone who is going to use their device as a speaker!  You are almost finished!! Hurray it\'s almost party time!!!\n</p>\n\n<a href="'+preplayurl+'" style="margin-left:30px;margin-right:auto;font-family:sans-serif;font-size:14px;display:block"> <p style=""> http://localhost/MHACKS/upload3/preplay.html</p></a>\n<img src="http://api.qrserver.com/v1/create-qr-code/?data=http%3A%2F%2F169.254.8.45%2FMHACKS%2F'+fn.replace('/','')+'%2Fpreplay.php&#38;size=435x435&#38;prov=goqrme" alt="QR Code generator" title="" />\n<form action="activate.php">\n<input style="margin-left:30px;font-sans-serif;font-size:14" type="submit" name="Play" value="Play">\n</form>\n\n\n</body>\n</html>'
#simple look g3='<!DOCTYPE HTML>\n<html>\n<body>\n<a href="'+preplayurl+'">'+preplayurl+'</a>\n<form action="activate.php">\n<input type="submit" name="Play" value="Play">\n</form>\n\n\n</body>\n</html>'
f3=open(fn+'controller.html','w')
f3.write(g3)
f3.close()

g4='<?php\nheader("Location: play.html");\n$control_file = \'control.txt\';\nwhile(time_nanosleep(0, 200000000))\n{\n\t$data = fread(fopen($control_file, \'r\'),1);\n\tif($data!=\'-\')\n\t{\n\t\texit;\n\t}\n}\n?>\n'
f4=open(fn+'preplay.php','w')
f4.write(g4)
f4.close()

#g5='import sys\nbaseurl="'+baseurl+'"\naudioname = sys.argv[1]\ntstart=sys.argv[2]\n\ng1=\'<!DOCTYPE HTML>\\n<html>\\n<head>\\n<audio id="music" source src="\'+str(audioname)+\'"  type="audio/mpeg">\\n\\tYour browser does not support the audio element.\\n</audio>\\n</head>\\n<body>\\n<script>\\nvar audio=document.getElementById("music");\\nvar Tstart = \'+str(tstart)+\';\\nfunction playmusic()\\n{\\n\\tmusic.play();\\n}\\nfunction pausemusic()\\n{\\n\\tmusic.pause();\\n}\\nfunction loadit() {\\n\\tplaymusic();\\n\\tpausemusic();\\n\\twhile(Math.round(new Date().getTime()) <=Tstart*1000);\\n\\tplaymusic();\\n\\t}\\n</script>\\n<button onclick="loadit()" type="button">Initialize</button>\\n<button onclick="playmusic()" type="button">Play</button>\\n<button onclick="pausemusic()" type="button">Pause</button>\\n</body>\\n</html>\'\nf1 = open(\'play.html\' ,\'w\')\nf1.write(g1)\nf1.close()\n'
g5 = 'import sys\nbaseurl="http://169.254.8.45/MHACKS/"\naudioname = sys.argv[1]\ntstart=sys.argv[2]\n\n#g1=\'<!DOCTYPE HTML>\\n<html>\\n<head>\\n<audio id="music" source src="\'+str(audioname)+\'"  type="audio/mpeg">\\n\\tYour browser does not support the audio element.\\n</audio>\\n</head>\\n<body>\\n<script>\\nvar audio=document.getElementById("music");\\nvar Tstart = \'+str(tstart)+\';\\nfunction playmusic()\\n{\\n\\tmusic.play();\\n}\\nfunction pausemusic()\\n{\\n\\tmusic.pause();\\n}\\nfunction loadit() {\\n\\tplaymusic();\\n\\tpausemusic();\\n\\twhile(Math.round(new Date().getTime()) <=Tstart*1000);\\n\\tplaymusic();\\n\\t}\\n</script>\\n<button onclick="loadit()" type="button">Initialize</button>\\n<button onclick="playmusic()" type="button">Play</button>\\n<button onclick="pausemusic()" type="button">Pause</button>\\n</body>\\n</html>\'\ng1 = \'<!DOCTYPE html>\\n\\n<html >\\n\\t<head>\\n\\t\\t<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\\n\\t\\t<title></title>\\n\\t\\t   <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>\\n    <script type="text/javascript" src="custom.js"></script>\\n\\t\\t<link href="style.css" rel="stylesheet" type="text/css" />\\n\\t\\t<audio id="music" source src="\'+audioname+\'"  type="audio/mpeg">\\n\\tYour browser does not support the audio element.\\n</audio>\\n\\t</head>\\n\\t\\n\\t<body>\\n\\t\\t<div id="container">\\n    \\t\\t<!-- header -->\\n\\t        <div id="logo"><a href="#">Welcome to Flukebox</a></div>\\n\\t\\t\\t\\t<div id="menu">\\n\\t\\t\\t\\t\\t<a href="#">Home</a>\\n\\t\\t\\t\\t\\t<a class="show-popup" href="#"> Learn More</a> \\n            \\t\\t\\n            \\t\\t<div class="overlay-bg">\\n            \\t\\t\\t<div class="overlay-content">\\n\\t\\t            \\t\\t<p> \\n\\t\\t\\t\\t\\t\\t\\t\\tAs the master of your party you get to pick the\\n\\t\\t\\t\\t\\t\\t\\t\\tsong to play!  Begin my choosing the .mp3 file\\n\\t\\t\\t\\t\\t\\t\\t\\tyou want to play.  (It can only be .mp3 or .m4a\\n\\t\\t\\t\\t\\t\\t\\t\\tformat.  The title cannot have apostrophes or \\n\\t\\t\\t\\t\\t\\t\\t\\tquotation marks!) Then when the users you want\\n\\t\\t\\t\\t\\t\\t\\t\\thave connect you click on the ready button and\\n\\t\\t\\t\\t\\t\\t\\t\\tyou can have all the users begin playing the\\n\\t\\t\\t\\t\\t\\t\\t\\tmusic.  Whoooo party!!!!\\n\\t\\t\\t\\t\\t\\t\\t</p>\\n\\t\\t\\t\\t\\t\\t\\t<button class="close-btn">Close</button>\\n\\t\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t</div>\\n        \\t<!--end header -->     \\n        \\t<!-- main -->\\n        \\t<div id="main">\\n        \\n          \\t\\t<div id="text">\\n            \\t\\t<h1>We are ready to rock!</h1>\\n            \\n\\t\\t\\t            <p><strong>Party Time!</strong> Everything is ready to go. It is all up to you now.  Make this party awesome.</p>\\n           \\t\\t</div>\\n           \\t\\t\\n<script>\\nvar audio=document.getElementById("music");\\nvar Tstart = \'+str(tstart)+\';\\nfunction playmusic()\\n{\\n\\tmusic.play();\\n}\\nfunction pausemusic()\\n{\\n\\tmusic.pause();\\n}\\nfunction loadit() {\\n\\tplaymusic();\\n\\tpausemusic();\\n\\twhile(Math.round(new Date().getTime()) <=Tstart*1000);\\n\\tplaymusic();\\n\\t}\\n</script>\\n<div id="text">\\n\\t<button onclick="loadit()" type="button">Initialize</button>\\n\\t<button onclick="playmusic()" type="button">Play</button>\\n\\t<button onclick="pausemusic()" type="button">Pause</button>\\n</div>\\n           \\t\\t\\n           \\t\\t\\n\\t\\t\\t</div>\\n    \\t\\t<!-- end main -->\\n\\t\\t    <!-- footer -->\\n\\t\\t    <div id="footer">\\n        \\t    <div id="menu_footer"><a href="#">home</a> | <a class="show-popup" href="#"> about</a> \\n            \\t\\t\\n            \\t\\t<div class="overlay-bg">\\n            \\t\\t\\t<div class="overlay-content">\\n\\t\\t            \\t\\t<p> \\n\\t\\t\\t\\t\\t\\t\\t\\tAs the master of your party you get to pick the\\n\\t\\t\\t\\t\\t\\t\\t\\tsong to play!  Begin my choosing the .mp3 file\\n\\t\\t\\t\\t\\t\\t\\t\\tyou want to play.  (It can only be .mp3 or .m4a\\n\\t\\t\\t\\t\\t\\t\\t\\tformat.) Then when the users you want have \\n\\t\\t\\t\\t\\t\\t\\t\\tconnect you click on the ready button and you \\n\\t\\t\\t\\t\\t\\t\\t\\tcan have all the users begin playing the music.\\n\\t\\t\\t\\t\\t\\t\\t\\tWhoooo party!!!!\\n\\t\\t\\t\\t\\t\\t\\t</p>\\n\\t\\t\\t\\t\\t\\t\\t<button class="close-btn">Close</button>\\n\\t\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t\\t</div>\\n            \\t\\t<div id="left_footer">&copy; Copyright 2014 <b>Flukebox</b></div>\\n\\t            <div id="right_footer">\\n\\n\\n   \\t\\t\\t\\t</div>\\n\\t\\t\\t</div>\\n    \\t\\t<!-- end footer -->\\n\\t\\t</div>\\n\\t</body>\\n</html>\\n\'\nf1 = open(\'play.html\' ,\'w\')\nf1.write(g1)\nf1.close()\n'
f5=open(fn+'create_timed_play_page.py','w')
f5.write(g5)
f5.close()

h = open(fn+'control.txt' ,'w')
h.write('-')
h.close()

os.system('cp body_bckg.jpg '+fn+'body_bckg.jpg')
dirno=int(fn.replace('upload','').replace('/',''))
os.system('cp qr_'+str(dirno)+'.png '+fn+'qr_'+str(dirno)+'.png')
os.system('cp style.css '+fn+'style.css')
os.system('cp custom.js '+fn+'custom.js')